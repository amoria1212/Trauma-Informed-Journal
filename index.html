<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gentle Reflection Journal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            background-color: #f4f0ed;
            color: #374151;
        }
        h1, h2, h3, h4 {
            font-family: 'Cormorant Garamond', serif;
        }
        .section-header {
            position: relative;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .section-header::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 50px;
            height: 3px;
            background-color: #D1D5DB;
            border-radius: 9999px;
        }
        .journal-box {
            background-color: #f0e8e6;
            border-left: 4px solid #D1D5DB;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
        }
        .journal-input {
            width: 100%;
            min-height: 3rem;
            border: 1px solid #d1d5db;
            background-color: #fff;
            padding: 0.5rem;
            border-radius: 0.375rem;
            resize: vertical;
            transition: border-color 0.2s ease;
        }
        .journal-input:focus {
            outline: none;
            border-color: #D1D5DB;
            box-shadow: 0 0 0 3px rgba(209, 213, 219, 0.5);
        }
        .btn {
            transition: all 0.2s ease;
            font-weight: 500;
        }
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .checkbox-custom {
            width: 18px;
            height: 18px;
            margin-right: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            accent-color: #D1D5DB;
        }
        @media print {
            .no-print {
                display: none !important;
            }
            body {
                background-color: white !important;
            }
            .journal-box {
                background-color: #f9f9f9 !important;
                page-break-inside: avoid;
            }
        }
        .info-box {
            background: #fdfae9;
            border: 1px solid #e6d8a2;
            padding: 1.5rem;
            border-radius: 0.75rem;
        }
        /* Modal Styles */
        .share-modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .share-modal.show {
            opacity: 1;
            visibility: visible;
        }
        .share-modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .share-option {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-radius: 0.75rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }
        .share-option:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .share-option .icon {
            font-size: 1.5rem;
            margin-right: 1rem;
            min-width: 2rem;
        }
        .share-option .content { flex: 1; }
        .share-option .title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        .share-option .description {
            font-size: 0.875rem;
            opacity: 0.8;
        }
        .save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        .save-indicator.show { opacity: 1; }
        .save-indicator.saved {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        .save-indicator.saving {
            background-color: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }
        .save-indicator.error {
            background-color: #FEE2E2;
            color: #991B1B;
            border: 1px solid #FECACA;
        }
        .save-indicator.success {
            background-color: #D1FAE5;
            color: #065F46;
            border: 1px solid #A7F3D0;
        }
    </style>
</head>
<body class="p-4 sm:p-8">
    
    <!-- Modal for Sharing -->
    <div id="shareModal" class="share-modal">
        <div class="share-modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-800">Share Your Journal</h3>
                <button onclick="closeShareModal()" class="text-gray-500 hover:text-gray-700 text-2xl close-button">&times;</button>
            </div>
            <p class="text-gray-600 mb-4">
                Choose how you'd like to share your journal entries with your therapist or a trusted individual.
            </p>
            
            <div class="space-y-3">
                <button onclick="shareViaEmail()" class="share-option" style="background-color: #EFF6FF; color: #1D4ED8;">
                    <span class="icon">üìß</span>
                    <div class="content">
                        <div class="title">Email as a Draft</div>
                        <div class="description">Opens your email client with responses pre-populated.</div>
                    </div>
                </button>
                
                <button onclick="copyToClipboard()" class="share-option" style="background-color: #F0FDF4; color: #15803D;">
                    <span class="icon">üìã</span>
                    <div class="content">
                        <div class="title">Copy to Clipboard</div>
                        <div class="description">Copy text to paste anywhere you choose.</div>
                    </div>
                </button>
                
                <button onclick="shareViaWebAPI()" class="share-option" id="webShareButton" style="background-color: #FAF5FF; color: #7C3AED; display: none;">
                    <span class="icon">üîó</span>
                    <div class="content">
                        <div class="title">Use My Device Sharing</div>
                        <div class="description">Share using your phone or computer's native share options.</div>
                    </div>
                </button>
                
                <button onclick="downloadFile()" class="share-option" style="background-color: #FFF7ED; color: #C2410C;">
                    <span class="icon">üíæ</span>
                    <div class="content">
                        <div class="title">Download as Text File</div>
                        <div class="description">Save a `.txt` file to your device.</div>
                    </div>
                </button>
            </div>
            
            <div class="mt-4 p-3 bg-yellow-50 rounded-lg">
                <p class="text-sm text-yellow-700">
                    <strong>Privacy Note:</strong> Your journal entries contain personal information. Please share thoughtfully and only with trusted individuals.
                </p>
            </div>
        </div>
    </div>

    <!-- Save Indicator -->
    <div id="saveIndicator" class="save-indicator">
        <span id="saveText">Auto-saving...</span>
    </div>
    
    <!-- Main Form Content -->
    <div class="max-w-4xl mx-auto bg-white p-6 sm:p-10 rounded-3xl shadow-2xl border border-gray-100">

        <!-- Action Buttons -->
        <div class="no-print flex flex-wrap gap-3 mb-6 justify-center sm:justify-end">
            <button id="shareBtn" onclick="openShareModal()" class="btn bg-purple-100 hover:bg-purple-200 text-purple-800 px-4 py-2 rounded-lg">
                üîó Share Journal
            </button>
            <button id="exportBtn" onclick="exportData()" class="btn bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg">
                üì• Export Responses
            </button>
            <button id="printBtn" onclick="window.print()" class="btn bg-blue-50 hover:bg-blue-100 text-blue-600 px-4 py-2 rounded-lg">
                üñ®Ô∏è Print
            </button>
            <button id="clearBtn" onclick="clearData()" class="btn bg-red-50 hover:bg-red-100 text-red-600 px-4 py-2 rounded-lg">
                üóëÔ∏è Clear All
            </button>
        </div>

        <!-- Introductory Header with Logo -->
        <header class="flex flex-col items-center mb-8 text-center">
            <div class="mb-4">
                <img src="https://i.imgur.com/JwAdvDd.png" alt="Janice LaFountaine, MS, LMFT Logo" class="h-24 w-auto rounded-full shadow-md">
            </div>
            <div class="flex-grow">
                <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 mb-2">Gentle Reflection Journal</h1>
                <p class="text-gray-600 leading-relaxed text-lg mb-4">
                    This journal is designed to gently guide you toward a deeper connection with your body and your emotions. These prompts prioritize safety and self-compassion, helping you build a foundation for healing.
                </p>
                <div class="info-box text-sm text-gray-700">
                    <p class="mb-2">üí° <strong>Gentle Reminder:</strong> There are no right or wrong answers. You can work at your own pace and use the export or share options to save your responses. This is your space for curious, compassionate self-reflection.</p>
                </div>
            </div>
        </header>

        <!-- Top 10 Journal Prompts Section -->
        <div class="space-y-8">
            <div class="journal-box">
                <h3 class="text-xl font-bold text-gray-800 mb-4">1. Understanding Your Protectors üõ°Ô∏è</h3>
                <p class="mb-2 text-sm font-semibold text-gray-600">Consider a part of you that is highly self-critical or anxious. Instead of pushing it away, get curious. What is this part afraid would happen if it stopped doing its job? What is its positive intention in trying to protect you?</p>
                <textarea class="journal-input" rows="4" data-key="prompt-1"></textarea>
            </div>

            <div class="journal-box">
                <h3 class="text-xl font-bold text-gray-800 mb-4">2. Finding Your Window of Tolerance üèûÔ∏è</h3>
                <p class="mb-2 text-sm font-semibold text-gray-600">Describe a time today or this week when you felt calm, present, and engaged‚Äînot overwhelmed, and not shut down. What did that state of "just right" feel like in your body and mind?</p>
                <textarea class="journal-input" rows="4" data-key="prompt-2"></textarea>
            </div>

            <div class="journal-box">
                <h3 class="text-xl font-bold text-gray-800 mb-4">3. Identifying a "Felt Sense" of Safety üè°</h3>
                <p class="mb-2 text-sm font-semibold text-gray-600">What does true "emotional safety" feel like in your body? Describe the physical sensations and thoughts that accompany this feeling of security.</p>
                <textarea class="journal-input" rows="4" data-key="prompt-3"></textarea>
            </div>

            <div class="journal-box">
                <h3 class="text-xl font-bold text-gray-800 mb-4">4. Listening to Your Body's Signals üßò</h3>
                <p class="mb-2 text-sm font-semibold text-gray-600">Pause and bring your attention inward. Without needing a reason, ask your body what it needs right now. Is it asking for a stretch, a glass of water, a deep breath, or a moment of stillness?</p>
                <textarea class="journal-input" rows="4" data-key="prompt-4"></textarea>
            </div>

            <div class="journal-box">
                <h3 class="text-xl font-bold text-gray-800 mb-4">5. Attuning to Your Inner Child ‚ù§Ô∏è</h3>
                <p class="mb-2 text-sm font-semibold text-gray-600">Without focusing on a past event, what does your "inner child" need from you today to feel safe, seen, and loved?</p>
                <textarea class="journal-input" rows="4" data-key="prompt-5"></textarea>
            </div>

            <div class="journal-box">
                <h3 class="text-xl font-bold text-gray-800 mb-4">6. Understanding Coping Mechanisms ‚òï</h3>
                <p class="mb-2 text-sm font-semibold text-gray-600">Describe a "surrogate comfort" you use when feeling stressed (e.g., scrolling, shopping). What deeper emotional need‚Äîsuch as nurturing, safety, or comfort‚Äîmight this behavior be trying to meet?</p>
                <textarea class="journal-input" rows="4" data-key="prompt-6"></textarea>
            </div>

            <div class="journal-box">
                <h3 class="text-xl font-bold text-gray-800 mb-4">7. Examining the Purpose of a Belief ‚öôÔ∏è</h3>
                <p class="mb-2 text-sm font-semibold text-gray-600">Choose a belief that causes you pain. What purpose might this belief have served in the past? How might it have helped you make sense of the world or survive a difficult situation at one time?</p>
                <textarea class="journal-input" rows="4" data-key="prompt-7"></textarea>
            </div>

            <div class="journal-box">
                <h3 class="text-xl font-bold text-gray-800 mb-4">8. Meeting Your Needs in the Moment üéÅ</h3>
                <p class="mb-2 text-sm font-semibold text-gray-600">What is your primary unmet emotional need today: nurturing, safety, or inner guidance? How can you offer that to yourself using your five senses?</p>
                <textarea class="journal-input" rows="4" data-key="prompt-8"></textarea>
            </div>

            <div class="journal-box">
                <h3 class="text-xl font-bold text-gray-800 mb-4">9. The Experience of Receiving Care ü§≤</h3>
                <p class="mb-2 text-sm font-semibold text-gray-600">Reflect on a recent moment when someone offered you genuine kindness, a compliment, or support. What did it feel like in your body to receive it?</p>
                <textarea class="journal-input" rows="4" data-key="prompt-9"></textarea>
            </div>

            <div class="journal-box">
                <h3 class="text-xl font-bold text-gray-800 mb-4">10. Cultivating Self-Compassion üôè</h3>
                <p class="mb-2 text-sm font-semibold text-gray-600">Write a compassionate message to yourself, acknowledging your courage for engaging in healing work and affirming that your pace is the right pace.</p>
                <textarea class="journal-input" rows="4" data-key="prompt-10"></textarea>
            </div>

            <h2 class="text-2xl sm:text-3xl font-semibold text-gray-700 mt-12 mb-6 section-header">DBT-Aligned Skill Prompts</h2>
            <p class="text-gray-600 mb-6 leading-relaxed">
                These prompts are designed to help you actively apply concrete skills from Dialectical Behavior Therapy (DBT) to build resilience and ground yourself in the present moment.
            </p>

            <div class="journal-box">
                <h3 class="text-xl font-bold text-gray-800 mb-4">1. The Proactive Application of TIPP</h3>
                <p class="mb-2 text-sm font-semibold text-gray-600">Write about a hypothetical scenario where you feel an intense emotional wave coming on. What physiological signals do you notice in your body? Using the TIPP skill, describe exactly what you would do to bring your body's emotional arousal down to a manageable level.</p>
                <textarea class="journal-input" rows="4" data-key="dbt-prompt-1"></textarea>
            </div>

            <div class="journal-box">
                <h3 class="text-xl font-bold text-gray-800 mb-4">2. Mindful Self-Care with the PLEASE Skill</h3>
                <p class="mb-2 text-sm font-semibold text-gray-600">Reflect on your past 24 hours. Using the DBT skill "PLEASE," identify one way you could have better cared for your Physical Illness, balanced your EATing, avoided mood-altering substances, gotten adequate SLEEP, and exercised. How might addressing just one of these factors have changed your emotional state today?</p>
                <textarea class="journal-input" rows="4" data-key="dbt-prompt-2"></textarea>
            </div>

            <div class="journal-box">
                <h3 class="text-xl font-bold text-gray-800 mb-4">3. Assertive Communication with the FAST Skill</h3>
                <p class="mb-2 text-sm font-semibold text-gray-600">Think of a current relationship where you feel a need to express yourself or set a boundary. Using the DBT skill "FAST," write out your planned communication. How will you be Fair, how will you not Apologize for your position, how will you Stick to your values, and how will you be Truthful?</p>
                <textarea class="journal-input" rows="4" data-key="dbt-prompt-3"></textarea>
            </div>

            <div class="journal-box">
                <h3 class="text-xl font-bold text-gray-800 mb-4">4. Finding Freedom in Radical Acceptance</h3>
                <p class="mb-2 text-sm font-semibold text-gray-600">Describe a situation in your life that you find yourself repeatedly fighting against or trying to change, even though you know you have no control over it. Practice radical acceptance of this reality. How can you distinguish between accepting the reality of the situation and condoning it? Write about the suffering you might be able to let go of if you choose to stop fighting this unchangeable reality.</p>
                <textarea class="journal-input" rows="4" data-key="dbt-prompt-4"></textarea>
            </div>

            <div class="journal-box">
                <h3 class="text-xl font-bold text-gray-800 mb-4">5. Non-Judgmental Observation of Thoughts</h3>
                <p class="mb-2 text-sm font-semibold text-gray-600">For the next five minutes, simply observe the thoughts that pass through your mind. As a thought arises, you can label it‚Äîfor example, calling it 'a planning thought' or 'a memory thought.' Don't follow the thought or get caught up in it; just observe and label. What do you notice about the thoughts themselves? Did you feel any physical sensations as you observed them?</p>
                <textarea class="journal-input" rows="4" data-key="dbt-prompt-5"></textarea>
            </div>
        </div>

        <!-- Closing Remarks -->
        <p class="text-gray-600 mt-8 italic text-center text-lg">
            This journal is your personal tool for compassionate self-discovery. Use it at your own pace and bring your reflections to our next session.
        </p>

    </div>

    <script>
        // Core Variables
        let saveTimeout;
        const saveIndicator = document.getElementById('saveIndicator');
        const saveText = document.getElementById('saveText');

        // Initialization
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedData();
            
            // Show web share button if supported
            if (navigator.share) {
                document.getElementById('webShareButton').style.display = 'block';
            }
            
            // Event listeners for buttons
            document.getElementById('shareBtn').addEventListener('click', openShareModal);
            document.getElementById('exportBtn').addEventListener('click', exportData);
            document.getElementById('printBtn').addEventListener('click', () => window.print());
            document.getElementById('clearBtn').addEventListener('click', clearData);
            
            // Modal close events
            document.querySelector('#shareModal .close-button').addEventListener('click', closeShareModal);
            document.getElementById('shareModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeShareModal();
                }
            });
            
            // Escape key to close modal
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeShareModal();
                }
            });
        });

        // Auto-save functionality
        document.addEventListener('input', function(e) {
            if (e.target.matches('textarea[data-key]')) {
                showSaveIndicator('saving');
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => {
                    saveData(e.target);
                    showSaveIndicator('saved');
                    setTimeout(() => hideSaveIndicator(), 2000);
                }, 500);
            }
        });

        // Data management functions
        function saveData(element) {
            const key = element.getAttribute('data-key');
            localStorage.setItem(key, element.value);
        }

        function loadSavedData() {
            document.querySelectorAll('textarea[data-key]').forEach(textarea => {
                const key = textarea.getAttribute('data-key');
                const saved = localStorage.getItem(key);
                if (saved) {
                    textarea.value = saved;
                }
            });
        }

        function showSaveIndicator(status) {
            saveIndicator.className = `save-indicator show ${status}`;
            if (status === 'saving') {
                saveText.textContent = 'Auto-saving...';
            } else if (status === 'saved') {
                saveText.textContent = '‚úì Saved';
            } else if (status === 'success') {
                saveText.textContent = '‚úì Success';
            } else if (status === 'error') {
                saveText.textContent = '‚úó Error';
            }
        }

        function hideSaveIndicator() {
            saveIndicator.classList.remove('show');
        }

        // Modal functions
        function openShareModal() {
            document.getElementById('shareModal').classList.add('show');
        }

        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('show');
        }

        // Data collection function
        function collectAllData() {
            const data = {};
            document.querySelectorAll('textarea[data-key]').forEach(textarea => {
                const key = textarea.getAttribute('data-key');
                const value = textarea.value.trim();
                if (value) {
                    data[key] = value;
                }
            });
            return data;
        }

        // Format data for sharing
        function formatDataForSharing() {
            const data = collectAllData();
            const date = new Date().toLocaleDateString();
            
            let shareText = `GENTLE REFLECTION JOURNAL ENTRIES\n`;
            shareText += `Date: ${date}\n`;
            shareText += `Therapist: Janice LaFountaine, MS, LMFT\n`;
            shareText += `${'='.repeat(70)}\n\n`;
            
            // All Prompts
            const allPrompts = [
                { key: 'prompt-1', label: '1. Understanding Your Protectors üõ°Ô∏è' },
                { key: 'prompt-2', label: '2. Finding Your Window of Tolerance üèûÔ∏è' },
                { key: 'prompt-3', label: '3. Identifying a "Felt Sense" of Safety üè°' },
                { key: 'prompt-4', label: '4. Listening to Your Body\'s Signals üßò' },
                { key: 'prompt-5', label: '5. Attuning to Your Inner Child ‚ù§Ô∏è' },
                { key: 'prompt-6', label: '6. Understanding Coping Mechanisms ‚òï' },
                { key: 'prompt-7', label: '7. Examining the Purpose of a Belief ‚öôÔ∏è' },
                { key: 'prompt-8', label: '8. Meeting Your Needs in the Moment üéÅ' },
                { key: 'prompt-9', label: '9. The Experience of Receiving Care ü§≤' },
                { key: 'prompt-10', label: '10. Cultivating Self-Compassion üôè' },
                { key: 'dbt-prompt-1', label: '1. The Proactive Application of TIPP' },
                { key: 'dbt-prompt-2', label: '2. Mindful Self-Care with the PLEASE Skill' },
                { key: 'dbt-prompt-3', label: '3. Assertive Communication with the FAST Skill' },
                { key: 'dbt-prompt-4', label: '4. Finding Freedom in Radical Acceptance' },
                { key: 'dbt-prompt-5', label: '5. Non-Judgmental Observation of Thoughts' }
            ];
            
            allPrompts.forEach(p => {
                if (data[p.key]) {
                    shareText += `‚Ä¢ ${p.label}:\n  ${data[p.key]}\n\n`;
                }
            });
            
            shareText += `\n${'='.repeat(70)}\n`;
            shareText += `Generated from: Gentle Reflection Journal\n`;
            shareText += `Therapist: Janice LaFountaine, MS, LMFT\n`;
            shareText += `Date: ${date}`;
            
            return shareText;
        }

        // Sharing functions
        function shareViaEmail() {
            try {
                const shareText = formatDataForSharing();
                const subject = encodeURIComponent('My Journal Responses');
                const body = encodeURIComponent(shareText);
                const mailtoLink = `mailto:?subject=${subject}&body=${body}`;
                
                window.location.href = mailtoLink;
                closeShareModal();
                
                showSaveIndicator('success');
                saveText.textContent = '‚úì Email opened';
                setTimeout(() => hideSaveIndicator(), 2000);
            } catch (error) {
                console.error('Error sharing via email:', error);
                showSaveIndicator('error');
                saveText.textContent = '‚úó Email failed';
                setTimeout(() => hideSaveIndicator(), 3000);
            }
        }

        async function copyToClipboard() {
            try {
                const shareText = formatDataForSharing();
                
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    await navigator.clipboard.writeText(shareText);
                } else {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = shareText;
                    textArea.style.position = 'fixed';
                    textArea.style.opacity = '0';
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                }
                
                closeShareModal();
                showSaveIndicator('success');
                saveText.textContent = '‚úì Copied to clipboard';
                setTimeout(() => hideSaveIndicator(), 2000);
            } catch (error) {
                console.error('Error copying to clipboard:', error);
                closeShareModal();
                showSaveIndicator('error');
                saveText.textContent = '‚úó Copy failed';
                setTimeout(() => hideSaveIndicator(), 3000);
            }
        }

        async function shareViaWebAPI() {
            if (!navigator.share) {
                showSaveIndicator('error');
                saveText.textContent = '‚úó Sharing not supported';
                setTimeout(() => hideSaveIndicator(), 3000);
                return;
            }

            try {
                const shareText = formatDataForSharing();
                
                await navigator.share({
                    title: 'My Journal Responses',
                    text: shareText
                });
                
                closeShareModal();
                showSaveIndicator('success');
                saveText.textContent = '‚úì Shared successfully';
                setTimeout(() => hideSaveIndicator(), 2000);
            } catch (error) {
                if (error.name !== 'AbortError') {
                    console.error('Error sharing:', error);
                    showSaveIndicator('error');
                    saveText.textContent = '‚úó Sharing failed';
                    setTimeout(() => hideSaveIndicator(), 3000);
                }
                closeShareModal();
            }
        }

        function downloadFile() {
            try {
                const shareText = formatDataForSharing();
                const date = new Date().toISOString().split('T')[0];
                
                const blob = new Blob([shareText], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `trauma-journal-entries-${date}.txt`;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                closeShareModal();
                showSaveIndicator('success');
                saveText.textContent = '‚úì Downloaded successfully';
                setTimeout(() => hideSaveIndicator(), 2000);
            } catch (error) {
                console.error('Error downloading file:', error);
                closeShareModal();
                showSaveIndicator('error');
                saveText.textContent = '‚úó Download failed';
                setTimeout(() => hideSaveIndicator(), 3000);
            }
        }

        function exportData() {
            try {
                const shareText = formatDataForSharing();
                const date = new Date().toISOString().split('T')[0];
                
                const blob = new Blob([shareText], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `trauma-journal-export-${date}.txt`;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showSaveIndicator('success');
                saveText.textContent = '‚úì Exported successfully';
                setTimeout(() => hideSaveIndicator(), 2000);
            } catch (error) {
                console.error('Error exporting data:', error);
                showSaveIndicator('error');
                saveText.textContent = '‚úó Export failed';
                setTimeout(() => hideSaveIndicator(), 3000);
            }
        }

        function clearData() {
            if (confirm('Are you sure you want to clear all your responses? This cannot be undone.')) {
                document.querySelectorAll('[data-key]').forEach(element => {
                    const key = element.getAttribute('data-key');
                    localStorage.removeItem(key);
                    element.value = '';
                });
                
                showSaveIndicator('success');
                saveText.textContent = '‚úì Cleared successfully';
                setTimeout(() => hideSaveIndicator(), 2000);
            }
        }
    </script>
</body>
</html>
